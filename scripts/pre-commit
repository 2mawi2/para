#!/usr/bin/env bash
# Pre-commit hook: run tests
set -e
echo "Running pre-commit tests..."

# Check if we're in a worktree (not the main repository)
if git rev-parse --git-common-dir | grep -q "\.git/worktrees/"; then
    echo "Detected worktree context - running only unit tests to avoid interference"
    if command -v just &> /dev/null; then
        just test-unit
    elif command -v bats &> /dev/null && [ -d "tests" ]; then
        bats tests/test_para.bats tests/test_para_units.bats
    else
        echo "Warning: Cannot run tests - just or bats not available"
    fi
else
    echo "Running full test suite from main repository"
    if command -v just &> /dev/null; then
        just test
    elif command -v bats &> /dev/null && [ -d "tests" ]; then
        bats tests/
    else
        echo "Warning: Cannot run tests - just or bats not available"
    fi
fi 