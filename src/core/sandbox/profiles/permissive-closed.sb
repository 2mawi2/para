(version 1)

;; Para Sandboxing Profile - Permissive Closed
;; Allows most operations but restricts file writes and network access

;; Allow everything by default
(allow default)

;; Restrict file writes to specific paths
(deny file-write*)
(allow file-write*
    (subpath (param "TARGET_DIR"))
    (subpath (param "TMP_DIR"))
    (subpath (param "CACHE_DIR"))
    (subpath "/tmp")
    (subpath "/var/tmp")
    (subpath "/private/tmp")
    (subpath "/private/var/tmp")
    (regex #"^/var/folders/[^/]+/[^/]+/[^/]+/")
    (subpath (string-append (param "HOME_DIR") "/.para"))
    (subpath (string-append (param "HOME_DIR") "/.cargo"))
    (subpath (string-append (param "HOME_DIR") "/.rustup"))
    (subpath (string-append (param "HOME_DIR") "/.claude"))
    (literal (string-append (param "HOME_DIR") "/.claude.json"))
    (literal "/dev/stdout")
    (literal "/dev/stderr")
    (literal "/dev/null")
    (literal "/dev/tty")
    (literal "/dev/ptmx")
    (regex #"^/dev/ttys[0-9]+")
    (regex #"^/dev/pty[0-9]+")
)

;; Allow all network access except inbound connections
(allow network*)
(deny network-inbound)