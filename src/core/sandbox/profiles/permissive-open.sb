(version 1)

;; Para Sandboxing Profile - Permissive Open
;; This profile allows most operations but restricts file writes to specific directories

;; Allow all operations by default
(allow default)

;; Deny all file writes, then selectively allow specific paths
(deny file-write*)

;; Allow writes to specific directories
(allow file-write*
    ;; Para worktree directory (passed as parameter)
    (subpath (param "TARGET_DIR"))
    
    ;; System temporary directory
    (subpath (param "TMP_DIR"))
    
    ;; User cache directory
    (subpath (param "CACHE_DIR"))
    
    ;; Para-specific directories in user home
    (subpath (string-append (param "HOME_DIR") "/.para"))
    
    ;; Claude-specific directories
    (subpath (string-append (param "HOME_DIR") "/.claude"))
    (subpath (string-append (param "HOME_DIR") "/.config/claude"))
    (subpath (string-append (param "HOME_DIR") "/Library/Application Support/Claude"))
    
    ;; Standard output streams
    (literal "/dev/stdout")
    (literal "/dev/stderr")
    (literal "/dev/null")
    (literal "/dev/tty")
    (literal "/dev/ptmx")
    
    ;; Allow writes to pseudo-terminals (for interactive sessions)
    (regex #"^/dev/ttys[0-9]+")
    (regex #"^/dev/pty[0-9]+")
)

;; Allow all network operations
(allow network*)

;; Allow process operations (needed for subprocess spawning)
(allow process*)

;; Allow signal operations
(allow signal)

;; Allow IPC operations
(allow ipc*)

;; Allow mach operations (needed for macOS system calls)
(allow mach*)

;; Allow system info queries
(allow sysctl*)