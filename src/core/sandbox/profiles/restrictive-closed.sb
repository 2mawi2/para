(version 1)

;; Para Sandboxing Profile - Restrictive Closed
;; Most restrictive profile that still allows Claude to function
;; - Minimal file write access (repository and Claude config only)
;; - Full network access (required for Claude API)
;; - No access to cargo, home directory, or system files

;; Start with permissive-closed as base
(allow default)

;; Deny all file writes first
(deny file-write*)

;; Allow only essential file writes
(allow file-write*
    ;; Para worktree - the ONLY place users should write
    (subpath (param "TARGET_DIR"))
    
    ;; Claude's operational needs (not for user files)
    (subpath (string-append (param "HOME_DIR") "/.claude"))
    (literal (string-append (param "HOME_DIR") "/.claude.json"))
    
    ;; System temp directories (for Claude's internal use)
    (subpath (param "TMP_DIR"))
    (subpath "/tmp")
    (subpath "/private/tmp")
    (regex #"^/var/folders/[^/]+/[^/]+/[^/]+/")
    
    ;; Terminal devices
    (literal "/dev/stdout")
    (literal "/dev/stderr")
    (literal "/dev/null")
    (literal "/dev/tty")
    (literal "/dev/ptmx")
    (regex #"^/dev/ttys[0-9]+")
    (regex #"^/dev/pty[0-9]+")
)

;; Explicitly allow directory creation for Claude
(allow file-write-create
    (subpath (string-append (param "HOME_DIR") "/.claude"))
    (subpath (param "TMP_DIR"))
    (regex #"^/var/folders/[^/]+/[^/]+/[^/]+/")
)

;; Network restrictions - allow all network access
;; Note: We cannot selectively block localhost while allowing other IPs
;; macOS sandbox only supports "localhost" or "*" as host values
(allow network*)


